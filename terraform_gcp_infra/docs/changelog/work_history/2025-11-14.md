# ì‘ì—… ì´ë ¥ - 2025-11-14

**ì‘ì—…ì**: Codex  
**ë¸Œëœì¹˜**: 433_code

---

## ğŸ¯ ì‘ì—… ìš”ì•½
- jsj-game-m ë¡œë“œë°¸ëŸ°ì„œì˜ í—¬ìŠ¤ì²´í¬/ë°±ì—”ë“œ ì˜ì¡´ì„± ì¶©ëŒì„ ë‹¨ê³„ì ìœ¼ë¡œ í•´ê²°í•˜ê³  Jenkins íŒŒì´í”„ë¼ì¸ì—ì„œ apply ì„±ê³µì„ ì§€ì›
- Terragrunt ì˜ì¡´ì„± ì¶œë ¥ê³¼ MIG ìë™ ë§¤í•‘ ë¡œì§ì„ ë³µêµ¬í•´ ëŒ€ìƒ ì¸ìŠ¤í„´ìŠ¤ ê·¸ë£¹ì´ ë°±ì—”ë“œ ì„œë¹„ìŠ¤ì— ì •ìƒ ë°˜ì˜ë˜ë„ë¡ ì¡°ì •
- Jenkins ì‹¤í–‰ ì¤‘ ë°œìƒí•œ Terraform provider ìºì‹œ ë¶ˆì¼ì¹˜ ì´ìŠˆë¥¼ ì§„ë‹¨í•˜ê³  ì´ˆê¸°í™” ì ˆì°¨ë¥¼ ì•ˆë‚´

---

## âœ… ì™„ë£Œëœ ì‘ì—…
1. **í—¬ìŠ¤ì²´í¬ ì´ë¦„ ì¶©ëŒ í•´ì†Œ**
   - ë¡œë¹„/ì›¹ ìŠ¤íƒ `main.tf`ì— `local.health_check_name`ì„ ì¶”ê°€í•´ naming ëª¨ë“ˆ ê¸°ë³¸ê°’ì„ ìœ ì§€í•˜ë©´ì„œ tfvarsë¡œ ì„œë¹„ìŠ¤ë³„ ì´ë¦„ì„ ì§€ì •
   - `variables.tf`, `terraform.tfvars`, `terraform.tfvars.example`ì— `health_check_name` ì…ë ¥ì„ ì¶”ê°€í•˜ê³  `game-m-lobby-health`, `game-m-web-health`ë¡œ override
2. **í—¬ìŠ¤ì²´í¬ recreate ìˆœì„œ ë³´ì¥**
   - `modules/load-balancer/main.tf`ì—ì„œ ê¸€ë¡œë²Œ/ë¦¬ì „ í—¬ìŠ¤ì²´í¬ ë¦¬ì†ŒìŠ¤ì— `lifecycle { create_before_destroy = true }`ë¥¼ ì„ ì–¸í•´ ê¸°ì¡´ Backend Service ì°¸ì¡° ì¤‘ì—ë„ êµì²´ ê°€ëŠ¥í•˜ë„ë¡ ìˆ˜ì •
3. **Terragrunt ì˜ì¡´ì„± ì¶œë ¥ í™œì„±í™”**
   - `70-loadbalancers/*/terragrunt.hcl`ì—ì„œ `skip_outputs = true`ë¥¼ ì œê±°í•´ `50-workloads`ì˜ `instance_groups` ì¶œë ¥ì´ ì „ë‹¬ë˜ë„ë¡ ë³µì›
4. **MIG í•„í„° ë¡œì§ êµì²´**
   - Terragrunt `inputs.auto_instance_groups` í•„í„°ë¥¼ `length(regexall("lobby", lower(name))) > 0` í˜•íƒœë¡œ ë³€ê²½í•´ ë¬¸ìì—´ ì¡°ê±´ì„ ì•ˆì •ì ìœ¼ë¡œ í‰ê°€
5. **ë¬¸ì„œí™”**
   - `2025-11-13.md`ì— game-m ê°œì„  ë‚´ì—­ì„ ì •ë¦¬í•˜ê³  ì˜¤ëŠ˜ ì‘ì—… ì „ì²´ë¥¼ `2025-11-14.md` ë¬¸ì„œë¡œ ê¸°ë¡ (ë³¸ ë¬¸ì„œ)

---

## ğŸ› ëŒ€ì‘ ë° ë¶„ì„
- **Terraform provider ìºì‹œ ì˜¤ë¥˜**: Jenkinsì—ì„œ `google` 7.11.0 ìºì‹œê°€ `.terraform.lock.hcl`ê³¼ ë‹¤ë¥¸ ì²´í¬ì„¬ì„ ì§€ë…€ `Required plugins are not installed` ì˜¤ë¥˜ ë°œìƒ â†’ í•´ë‹¹ ë””ë ‰í„°ë¦¬ì—ì„œ `terraform init -upgrade` ë˜ëŠ” `.terraform` ì œê±° í›„ `terraform init`ìœ¼ë¡œ ë‹¤ì‹œ ì´ˆê¸°í™”í•˜ë„ë¡ ì•ˆë‚´

---

## ğŸ“Œ ì¶”ê°€ ë©”ëª¨ & FAQ
- **ë¡œë“œë°¸ëŸ°ì„œ ìë™ ë°±ì—”ë“œ ë§¤í•‘ ìœ„ì¹˜**
  - `70-loadbalancers/[service]/terragrunt.hcl`ì˜ `dependency "workloads"`ê°€ `../../50-workloads` ìŠ¤íƒì—ì„œ `instance_groups` ì¶œë ¥ì„ ì½ì–´ì˜µë‹ˆë‹¤.
  - ê°™ì€ íŒŒì¼ì˜ `inputs` ë¸”ë¡ì—ì„œ `auto_instance_groups`ë¥¼ êµ¬ì„±í•˜ë©´ì„œ MIG ì´ë¦„ì— `lobby`/`web`ì´ í¬í•¨ëœ í•­ëª©ë§Œ í•„í„°ë§í•©ë‹ˆë‹¤.
  - `main.tf` ë‚´ `locals.auto_backends`ê°€ ìœ„ ë§µì„ Backend Service `backends` ì…ë ¥ìœ¼ë¡œ ë³€í™˜í•´ `module "load_balancer"`ì— ì „ë‹¬í•©ë‹ˆë‹¤.
  - ë‹¤ë¥¸ MIGë¥¼ ë¶™ì´ë ¤ë©´ Terragrunt í•„í„°ë¥¼ ì¡°ì •í•˜ê±°ë‚˜ `terraform.tfvars`ì˜ `backends` í•­ëª©ì— ì§ì ‘ self-linkë¥¼ ì…ë ¥í•˜ë©´ ë©ë‹ˆë‹¤.
- **Destroy ì‹œ Terragrunt mock ì¶œë ¥ í—ˆìš©**
  - 50-workloadsë¥¼ ë¨¼ì € ì§€ìš´ ìƒíƒœì—ì„œ 70-loadbalancersë¥¼ destroyí•˜ë©´ dependency ì¶œë ¥ì´ ì—†ì–´ ì—ëŸ¬ê°€ ë°œìƒí•˜ë¯€ë¡œ `mock_outputs_allowed_terraform_commands`ì— `"destroy"`ë¥¼ í¬í•¨ì‹œì¼œ ë¹ˆ ë§µìœ¼ë¡œ ì§„í–‰ë˜ë„ë¡ ì¡°ì •í–ˆìŠµë‹ˆë‹¤.
  - ë™ì¼í•œ íŒ¨í„´ì„ `proj-default-templet/70-loadbalancer/terragrunt.hcl`ì—ë„ ë°˜ì˜í•´ ì‹ ê·œ í”„ë¡œì íŠ¸ í…œí”Œë¦¿ì—ì„œë„ ê°™ì€ ë¬¸ì œê°€ ì¬í˜„ë˜ì§€ ì•Šë„ë¡ í–ˆìŠµë‹ˆë‹¤.
- Jenkinsì—ì„œ Terragrunt ì‹¤í–‰ ì‹œ í”ŒëŸ¬ê·¸ì¸ ì˜¤ë¥˜ê°€ ë‚˜ë©´ `.terraform/` ì‚­ì œ í›„ `terragrunt init --upgrade`ë¥¼ ë¨¼ì € ìˆ˜í–‰í•˜ì„¸ìš”.

---

## ğŸ”— ì˜¤ëŠ˜ ì»¤ë°‹
- `fix(loadbalancer): game-m í—¬ìŠ¤ì²´í¬ ì´ë¦„ ì¶©ëŒ í•´ì†Œ`
- `fix(loadbalancer): í—¬ìŠ¤ì²´í¬ recreate ìˆœì„œ ë³´ì¥`
- `fix(loadbalancer): terragrunt ì˜ì¡´ì„± ì¶œë ¥ í™œì„±í™”`
- `fix(loadbalancer): MIG í•„í„° ìˆ˜ì • ë° ë¡œê·¸ ê°±ì‹ `
