## ğŸ“… ì„¸ì…˜ 3 ì‘ì—… ë‚´ì—­ (2025-10-29)

**ì‘ì—…ì**: jsj
**ëª©ì **: ì¤‘ì•™ ì§‘ì¤‘ì‹ Terraform State ê´€ë¦¬ êµ¬ì¡° êµ¬ì¶•

### ğŸ¯ ì‘ì—… ìš”ì•½

Bootstrap ê´€ë¦¬ìš© í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ì—¬ ëª¨ë“  Terraform Stateë¥¼ ì¤‘ì•™ì—ì„œ ê´€ë¦¬í•˜ëŠ” êµ¬ì¡°ë¥¼ í™•ë¦½í–ˆìŠµë‹ˆë‹¤.

### ì™„ë£Œëœ ì‘ì—… âœ…

#### 1. Bootstrap ê´€ë¦¬ìš© í”„ë¡œì íŠ¸ ìƒì„±

**ìƒì„±ëœ ë¦¬ì†ŒìŠ¤**:
- GCP í”„ë¡œì íŠ¸: `delabs-system-mgmt` (í”„ë¡œì íŠ¸ ë²ˆí˜¸: 20670919971)
- GCS ë²„í‚·: `delabs-terraform-state-prod` (Versioning í™œì„±í™”)
- ìœ„ì¹˜: US (multi-region)
- Deletion Policy: PREVENT (ì‹¤ìˆ˜ë¡œ ì‚­ì œ ë°©ì§€)

**ë³´ì•ˆ ì„¤ì •**:
- Versioning: Enabled (ìµœê·¼ 10ê°œ ë²„ì „ ë³´ê´€)
- Lifecycle: 30ì¼ ì§€ë‚œ ë²„ì „ ìë™ ì‚­ì œ
- Uniform bucket-level access: Enabled
- Force destroy: False (ì‚­ì œ ë³´í˜¸)

#### 2. Bootstrap ë””ë ‰í† ë¦¬ êµ¬ì¡° ìƒì„±

**ì‹ ê·œ íŒŒì¼ (6ê°œ)**:
```
terraform_gcp_infra/bootstrap/
â”œâ”€â”€ main.tf              # í”„ë¡œì íŠ¸ ë° ë²„í‚· ë¦¬ì†ŒìŠ¤
â”œâ”€â”€ variables.tf         # ë³€ìˆ˜ ì •ì˜
â”œâ”€â”€ terraform.tfvars     # ì‹¤ì œ ì„¤ì • ê°’
â”œâ”€â”€ outputs.tf           # ì¶œë ¥ ê°’
â”œâ”€â”€ 00_README.md            # ìƒì„¸ ë¬¸ì„œ
â””â”€â”€ .terraform.lock.hcl  # Provider ë²„ì „ ì ê¸ˆ
```

**Bootstrapì˜ íŠ¹ì§•**:
- Local backend ì‚¬ìš© (terraform.tfstateë¥¼ ë¡œì»¬ì— ì €ì¥)
- ì´ê²ƒì´ ëª¨ë“  ë‹¤ë¥¸ í”„ë¡œì íŠ¸ì˜ Stateë¥¼ ë³´ê´€í•˜ëŠ” ë²„í‚·ì„ ìƒì„±
- âš ï¸ ë¡œì»¬ state íŒŒì¼ì€ ì•ˆì „í•˜ê²Œ ë°±ì—… í•„ìš”

#### 3. Backend ì„¤ì • ì—…ë°ì´íŠ¸ (6ê°œ ë ˆì´ì–´)

proj-game-aì˜ ëª¨ë“  ë ˆì´ì–´ì˜ backend ì„¤ì •ì„ ìƒˆë¡œìš´ ì¤‘ì•™ ë²„í‚·ìœ¼ë¡œ ì—…ë°ì´íŠ¸:

**ë³€ê²½ëœ íŒŒì¼**:
1. `environments/prod/proj-game-a/00-project/backend.tf`
2. `environments/prod/proj-game-a/10-network/backend.tf`
3. `environments/prod/proj-game-a/20-storage/backend.tf`
4. `environments/prod/proj-game-a/30-security/backend.tf`
5. `environments/prod/proj-game-a/40-observability/backend.tf`
6. `environments/prod/proj-game-a/50-workloads/backend.tf`

**ë³€ê²½ ë‚´ìš©**:
```diff
terraform {
  backend "gcs" {
-   bucket = "gcp-tfstate-prod"
+   bucket = "delabs-terraform-state-prod"
    prefix = "proj-game-a/XX-layer"
  }
}
```

### ğŸ“Š ì•„í‚¤í…ì²˜ ê°œì„ 

#### Before (ë¬¸ì œì )
```
ê° í”„ë¡œì íŠ¸ë§ˆë‹¤ ê°œë³„ State ë²„í‚·
â”œâ”€ gcp-tfstate-prod (ì¡´ì¬í•˜ì§€ ì•Šì•˜ìŒ)
â”œâ”€ í”„ë¡œì íŠ¸ ì‚­ì œ ì‹œ State ì†ì‹¤ ìœ„í—˜
â””â”€ ë¶„ì‚°ëœ State ê´€ë¦¬
```

#### After (ê°œì„ ë¨)
```
ì¤‘ì•™ ê´€ë¦¬ìš© í”„ë¡œì íŠ¸
â”œâ”€ delabs-system-mgmt (ê´€ë¦¬ ì „ìš©)
â”‚  â””â”€ delabs-terraform-state-prod/
â”‚     â”œâ”€ proj-game-a/00-project/
â”‚     â”œâ”€ proj-game-a/10-network/
â”‚     â”œâ”€ proj-game-a/20-storage/
â”‚     â”œâ”€ proj-game-a/...
â”‚     â”œâ”€ proj-game-b/...
â”‚     â””â”€ proj-game-c/...
â”‚
â”œâ”€ proj-game-a (ì›Œí¬ë¡œë“œ)
â”œâ”€ proj-game-b (ì›Œí¬ë¡œë“œ)
â””â”€ proj-game-c (ì›Œí¬ë¡œë“œ)
```

**ì¥ì **:
1. âœ… State ì¤‘ì•™ ì§‘ì¤‘ ê´€ë¦¬
2. âœ… í”„ë¡œì íŠ¸ ì‚­ì œí•´ë„ State ë³´ì¡´
3. âœ… í†µí•©ëœ ì ‘ê·¼ ì œì–´ (IAM)
4. âœ… ìë™ Versioning ë° ë°±ì—…
5. âœ… 10ê°œ ì´ìƒì˜ í”„ë¡œì íŠ¸ í™•ì¥ ê°€ëŠ¥

### ğŸ”§ ë°°í¬ ê³¼ì •

```bash
# 1. Bootstrap ë””ë ‰í† ë¦¬ ìƒì„±
mkdir terraform_gcp_infra/bootstrap

# 2. Terraform ì´ˆê¸°í™”
cd bootstrap
terraform init

# 3. Plan í™•ì¸
terraform plan
# â†’ 5ê°œ ë¦¬ì†ŒìŠ¤ ìƒì„± ì˜ˆì •

# 4. ë°°í¬ ì‹¤í–‰
terraform apply -auto-approve
# â†’ ì„±ê³µ: í”„ë¡œì íŠ¸ ìƒì„± (3ë¶„ 16ì´ˆ)
# â†’ ì„±ê³µ: API í™œì„±í™” (23ì´ˆ)
# â†’ ì„±ê³µ: ë²„í‚· ìƒì„± (2ì´ˆ)

# 5. Backend ì„¤ì • ì—…ë°ì´íŠ¸
sed -i 's/gcp-tfstate-prod/delabs-terraform-state-prod/g' */backend.tf

# 6. ê²€ì¦
gcloud projects describe delabs-system-mgmt
gsutil versioning get gs://delabs-terraform-state-prod
```

### âš ï¸ ì¤‘ìš” ì£¼ì˜ì‚¬í•­

#### Bootstrap State íŒŒì¼ ë°±ì—…

Bootstrap í”„ë¡œì íŠ¸ì˜ `terraform.tfstate`ëŠ” ë¡œì»¬ì— ì €ì¥ë©ë‹ˆë‹¤:
```bash
# ìœ„ì¹˜
terraform_gcp_infra/bootstrap/terraform.tfstate (9.2KB)

# ë°±ì—… ë°©ë²• 1: ìˆ˜ë™ ë³µì‚¬
cp terraform.tfstate ~/backup/bootstrap-$(date +%Y%m%d).tfstate

# ë°±ì—… ë°©ë²• 2: ë‹¤ë¥¸ GCS ë²„í‚·ì— ì—…ë¡œë“œ
gsutil cp terraform.tfstate gs://your-backup-bucket/bootstrap/

# ë°±ì—… ë°©ë²• 3: Git ì•”í˜¸í™” (git-crypt ì‚¬ìš©)
```

âš ï¸ **ì´ íŒŒì¼ì„ ìƒì–´ë²„ë¦¬ë©´ Bootstrap í”„ë¡œì íŠ¸ë¥¼ Terraformìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ì—†ê²Œ ë©ë‹ˆë‹¤!**

### ğŸ“ ë³€ê²½ëœ íŒŒì¼ ëª©ë¡

**ì‹ ê·œ íŒŒì¼ (6ê°œ)**:
1. `terraform_gcp_infra/bootstrap/main.tf`
2. `terraform_gcp_infra/bootstrap/variables.tf`
3. `terraform_gcp_infra/bootstrap/terraform.tfvars`
4. `terraform_gcp_infra/bootstrap/outputs.tf`
5. `terraform_gcp_infra/bootstrap/README.md`
6. `terraform_gcp_infra/bootstrap/.terraform.lock.hcl`

**ìˆ˜ì •ëœ íŒŒì¼ (6ê°œ)**:
1. `environments/prod/proj-game-a/00-project/backend.tf`
2. `environments/prod/proj-game-a/10-network/backend.tf`
3. `environments/prod/proj-game-a/20-storage/backend.tf`
4. `environments/prod/proj-game-a/30-security/backend.tf`
5. `environments/prod/proj-game-a/40-observability/backend.tf`
6. `environments/prod/proj-game-a/50-workloads/backend.tf`

**Git ì»¤ë°‹**:
```
commit 833e0d4
feat: Bootstrap ê´€ë¦¬ìš© í”„ë¡œì íŠ¸ ë° ì¤‘ì•™ ì§‘ì¤‘ì‹ State ê´€ë¦¬ êµ¬ì¡° ì¶”ê°€

- delabs-system-mgmt ê´€ë¦¬ìš© í”„ë¡œì íŠ¸ ìƒì„±
- delabs-terraform-state-prod GCS ë²„í‚· ìƒì„± (versioning í™œì„±í™”)
- Bootstrap ë””ë ‰í† ë¦¬ ì¶”ê°€ (terraform_gcp_infra/bootstrap/)
- ëª¨ë“  proj-game-a ë ˆì´ì–´ì˜ backend ì„¤ì •ì„ ìƒˆ ë²„í‚·ìœ¼ë¡œ ì—…ë°ì´íŠ¸
- State íŒŒì¼ ì¤‘ì•™ ê´€ë¦¬ êµ¬ì¡° í™•ë¦½

12 files changed, 342 insertions(+), 6 deletions(-)
```

### ğŸš€ ë‹¤ìŒ ì„¸ì…˜ ì‘ì—… (ìš°ì„ ìˆœìœ„)

#### Priority 1: ìƒˆ í”„ë¡œì íŠ¸ ë°°í¬ í…ŒìŠ¤íŠ¸
1. proj-game-aì˜ 00-project ì¬ë°°í¬
2. ìƒˆë¡œìš´ ë²„í‚·ì— Stateê°€ ì •ìƒì ìœ¼ë¡œ ì €ì¥ë˜ëŠ”ì§€ í™•ì¸
3. ë‚˜ë¨¸ì§€ ë ˆì´ì–´ ìˆœì°¨ ë°°í¬

#### Priority 2: ë‹¤ë¥¸ í”„ë¡œì íŠ¸ ì ìš©
1. proj-game-bì˜ backend ì„¤ì • ì—…ë°ì´íŠ¸
2. dev, stg í™˜ê²½ì˜ backend ì„¤ì • ì—…ë°ì´íŠ¸

#### Priority 3: ë°±ì—… ìë™í™”
1. Bootstrap state íŒŒì¼ ë°±ì—… ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±
2. Cron jobìœ¼ë¡œ ì£¼ê¸°ì  ë°±ì—… ì„¤ì •

#### Priority 4: ë¬¸ì„œí™”
1. ìƒˆ í”„ë¡œì íŠ¸ ì¶”ê°€ ê°€ì´ë“œ ì‘ì„±
2. Bootstrap ê´€ë¦¬ ê°€ì´ë“œ ì—…ë°ì´íŠ¸

### ğŸ’¡ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤ ì ìš©

ì´ë²ˆ ì‘ì—…ì—ì„œ ì ìš©í•œ ì—…ê³„ í‘œì¤€:

1. **ì¤‘ì•™ ì§‘ì¤‘ì‹ State ê´€ë¦¬**
   - Google, AWS ë“± ëŒ€ê¸°ì—…ì—ì„œ ì‚¬ìš©í•˜ëŠ” íŒ¨í„´
   - Terraform Cloud/Enterpriseì˜ ê¸°ë³¸ ê°œë…

2. **Bootstrap íŒ¨í„´**
   - "ë‹­ê³¼ ë‹¬ê±€" ë¬¸ì œ í•´ê²°
   - ê´€ë¦¬ ì¸í”„ë¼ë¥¼ ì›Œí¬ë¡œë“œì™€ ë¶„ë¦¬

3. **Versioning & Lifecycle**
   - State ì´ë ¥ ë³´ê´€ (ìµœê·¼ 10ê°œ ë²„ì „)
   - ìë™ ì •ë¦¬ (30ì¼ í›„ ì‚­ì œ)

4. **ë³´ì•ˆ ê°•í™”**
   - Deletion Policy: PREVENT
   - Force Destroy: False
   - Uniform bucket-level access

### ğŸ“š ì°¸ê³  ìë£Œ

- [Terraform Backend Configuration](https://developer.hashicorp.com/terraform/language/settings/backends/gcs)
- [GCS Versioning](https://cloud.google.com/storage/docs/object-versioning)
- [Terraform Best Practices - State Management](https://www.terraform-best-practices.com/state)

---

