# Terragrunt entrypoint: environments/LIVE/proj-default-templet/50-workloads/terragrunt.hcl
# 워크로드(GCE VM 세트) 설정 예시

# 공통 입력 (루트 root.hcl의 inputs로 대체 가능)
project_id     = "your-project-id"
project_name   = "default-templet"
environment    = "prod"
organization   = "myorg"
region_primary = "us-central1"
region_backup  = "us-east1"

# 기본값 (roles/instances에서 override 가능)
instance_count     = 0                 # for_each 맵 사용 → count 방식 비활성화
machine_type       = "e2-micro"
image_family       = "debian-12"
image_project      = "debian-cloud"
boot_disk_size_gb  = 20
boot_disk_type     = "pd-balanced"
enable_public_ip   = false
enable_os_login    = true
preemptible        = false
startup_script     = ""
service_account_scopes = ["https://www.googleapis.com/auth/cloud-platform"]
tags = ["prod", "ssh-allowed"]
labels = {
  app = "default-templet"
}

# 역할별 인스턴스 정의 (예: lobby 2대, web 2대, was 1대)
instances = {
  "tmpl-lobby-01" = {
    hostname             = "tmpl-lobby-01"
    zone                 = "us-central1-a"
    machine_type         = "e2-small"
    subnetwork_self_link = "projects/your-project-id/regions/us-central1/subnetworks/default-templet-subnet-dmz"
    tags                 = ["lobby", "ssh-allowed"]
    labels = {
      role = "lobby"
      tier = "frontend"
    }
    startup_script_file = "scripts/lobby.sh"
  }

  "tmpl-lobby-02" = {
    hostname             = "tmpl-lobby-02"
    zone                 = "us-central1-b"
    subnetwork_self_link = "projects/your-project-id/regions/us-central1/subnetworks/default-templet-subnet-dmz"
    tags                 = ["lobby", "ssh-allowed"]
    labels = {
      role = "lobby"
      tier = "frontend"
    }
    startup_script_file = "scripts/lobby.sh"
  }

  "tmpl-web-01" = {
    hostname             = "tmpl-web-01"
    zone                 = "us-central1-a"
    machine_type         = "e2-medium"
    subnetwork_self_link = "projects/your-project-id/regions/us-central1/subnetworks/default-templet-subnet-dmz"
    tags                 = ["web", "ssh-allowed"]
    labels = {
      role = "web"
      tier = "frontend"
    }
    startup_script_file = "scripts/lobby.sh"
  }

  "tmpl-web-02" = {
    hostname             = "tmpl-web-02"
    zone                 = "us-central1-b"
    subnetwork_self_link = "projects/your-project-id/regions/us-central1/subnetworks/default-templet-subnet-dmz"
    tags                 = ["web", "ssh-allowed"]
    labels = {
      role = "web"
      tier = "frontend"
    }
    startup_script_file = "scripts/lobby.sh"
  }

  "tmpl-was-01" = {
    hostname             = "tmpl-was-01"
    zone                 = "us-central1-c"
    machine_type         = "e2-standard-4"
    subnetwork_self_link = "projects/your-project-id/regions/us-central1/subnetworks/default-templet-subnet-private"
    tags                 = ["was", "ssh-allowed"]
    labels = {
      role = "was"
      tier = "backend"
    }
    startup_script_file = "scripts/was.sh"
  }

  "tmpl-was-02" = {
    hostname             = "tmpl-was-02"
    zone                 = "us-central1-a"
    machine_type         = "e2-standard-4"
    subnetwork_self_link = "projects/your-project-id/regions/us-central1/subnetworks/default-templet-subnet-private"
    tags                 = ["was", "ssh-allowed"]
    labels = {
      role = "was"
      tier = "backend"
    }
    image_family         = "ubuntu-2204-lts"
    image_project        = "ubuntu-os-cloud"
    startup_script_file  = "scripts/was.sh"
  }
}
