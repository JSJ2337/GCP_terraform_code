# Terragrunt entrypoint: environments/LIVE/proj-default-templet/10-network/terragrunt.hcl
# 네트워크 레이어 설정 예시
# 1) 이 파일을 terraform.tfvars로 복사
# 2) VPC/Subnet/방화벽 등 필요한 값을 채운 뒤 적용
# 3) terraform.tfvars는 Git에 커밋하지 마세요

project_id     = "jsj-game-l"
project_name   = "game-l"
environment    = "prod"
organization   = "jsj-dev"
region_primary = "asia-northeast3"
region_backup  = "asia-northeast1"

# VPC 라우팅 모드: 글로벌 라우팅이 필요 없으면 REGIONAL 로 변경하세요.
routing_mode = "GLOBAL"

# 용도별 서브넷 (DMZ/Private/WAS/DB 등) - 50-workloads와 70-loadbalancer에서 참조
additional_subnets = [
  {
    name   = "game-l-subnet-dmz"
    region = "asia-northeast3"
    cidr   = "10.4.0.0/24"
  },
  {
    name   = "game-l-subnet-private"
    region = "asia-northeast3"
    cidr   = "10.4.1.0/24"
  },
  {
    name   = "game-l-subnet-db"
    region = "asia-northeast3"
    cidr   = "10.4.2.0/24"
  }
]

dmz_subnet_name     = "game-l-subnet-dmz"
private_subnet_name = "game-l-subnet-private"
db_subnet_name      = "game-l-subnet-db"

# Cloud NAT 동시 연결 수(포트)
nat_min_ports_per_vm = 1024

# 방화벽 규칙 예시
firewall_rules = [
  {
    name           = "allow-ssh-from-iap"
    direction      = "INGRESS"
    ranges         = ["35.235.240.0/20"]          # IAP 고정 IP
    allow_protocol = "tcp"
    allow_ports    = ["22"]
    target_tags    = ["ssh-allowed"]
    description    = "IAP를 통한 SSH 허용"
  },
  {
    name           = "allow-game-traffic"
    direction      = "INGRESS"
    ranges         = ["10.4.0.0/16"]
    allow_protocol = "tcp"
    allow_ports    = ["8080", "9090"]
    target_tags    = ["game", "app"]
    description    = "Allow internal game traffic between subnets"
  },
  {
    name           = "allow-health-check"
    direction      = "INGRESS"
    ranges         = ["130.211.0.0/22", "35.191.0.0/16"]
    allow_protocol = "tcp"
    allow_ports    = ["8080"]
    target_tags    = ["lb-health-check"]
    description    = "Google 로드밸런서 헬스체크 허용"
  }
]

# Cloud SQL Private IP 등을 사용하려면 true 유지
enable_private_service_connection          = true
private_service_connection_prefix_length   = 24   # 256 IP 예약
private_service_connection_name            = ""   # 비워두면 자동 이름 사용
