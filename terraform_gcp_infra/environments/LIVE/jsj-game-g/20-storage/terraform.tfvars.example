# Terragrunt entrypoint: environments/LIVE/proj-default-templet/20-storage/terragrunt.hcl
# 스토리지 모듈 설정 예시
# 이 파일을 terraform.tfvars로 복사한 뒤 실제 값을 입력하세요.
# 버킷 이름/라벨 기본값은 modules/naming 결과와 병합됩니다.

project_id     = "your-project-id"
project_name   = "default-templet"
environment    = "prod"
organization   = "myorg"
region_primary = "us-central1"
region_backup  = "us-east1"

# 공통 라벨: naming 모듈이 제공하는 공통 라벨에 추가로 병합됩니다.
default_labels = {
  component = "storage"
}

# 조직 정책에 따라 Public Access 차단 및 버킷 정책 잠금 여부를 조정하세요.
uniform_bucket_level_access = true
public_access_prevention    = "enforced"

# (선택) 버킷을 CMEK로 암호화할 때만 설정합니다.
# kms_key_name = "projects/YOUR_PROJECT/locations/REGION/keyRings/KEYRING/cryptoKeys/KEY"

# === 자산(Assets) 버킷 ===
assets_bucket_location      = "US-CENTRAL1"
assets_bucket_storage_class = "STANDARD"
assets_bucket_labels = {
  bucket_type = "assets"
}
assets_enable_versioning = true
assets_lifecycle_rules = [
  {
    condition = { num_newer_versions = 3 }
    action    = { type = "Delete" }
  }
]
assets_cors_rules = [
  {
    origin          = ["https://yourgame.com"]
    method          = ["GET", "HEAD"]
    response_header = ["*"]
    max_age_seconds = 3600
  }
]
assets_iam_bindings = [
  # 예시: 모든 인증된 사용자 읽기 허용
  # {
  #   role    = "roles/storage.objectViewer"
  #   members = ["allAuthenticatedUsers"]
  # }
]

# === 로그(Logs) 버킷 ===
logs_bucket_location      = "US-CENTRAL1"
logs_bucket_storage_class = "COLDLINE"
logs_enable_versioning    = false
logs_bucket_labels = {
  bucket_type = "logs"
}
logs_lifecycle_rules = [
  {
    condition = { age = 90 }
    action    = { type = "Delete" }
  }
]
logs_retention_policy_days   = 7
logs_retention_policy_locked = false
logs_cors_rules              = []
logs_iam_bindings            = []

# === 백업(Backups) 버킷 ===
backups_bucket_location      = "US"        # 멀티 리전 권장
backups_bucket_storage_class = "ARCHIVE"
backups_bucket_labels = {
  bucket_type = "backups"
}
backups_enable_versioning = true
backups_lifecycle_rules = [
  {
    condition = { age = 365 }
    action    = { type = "Delete" }
  }
]
backups_retention_policy_days   = 30
backups_retention_policy_locked = false
backups_cors_rules              = []
backups_iam_bindings            = []
