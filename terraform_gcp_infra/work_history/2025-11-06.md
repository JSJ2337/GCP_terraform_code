## ğŸ“… ì„¸ì…˜ 13 ì‘ì—… ë‚´ì—­ (2025-11-06)

**ì‘ì—…ì**: jsj
**ëª©ì **: Jenkins CI/CD í†µí•© ë° Terragrunt ì‹¤í–‰ ìµœì í™”

### ğŸ¯ ì‘ì—… ìš”ì•½
- Jenkins Pipelineì„ í†µí•œ Terraform/Terragrunt ìë™í™” êµ¬ì„±
- Bootstrap Service Accountì˜ ê¶Œí•œ ì„¤ì • ë° Jenkins ì¸ì¦ í†µí•©
- Terragrunt in-place ì‹¤í–‰ìœ¼ë¡œ ëª¨ë“ˆ ê²½ë¡œ ë¬¸ì œ í•´ê²°
- GCS remote_state í•„ìˆ˜ íŒŒë¼ë¯¸í„° ì¶”ê°€
- 4ê°œì˜ Jenkins Pipeline ì—ëŸ¬ë¥¼ í•´ê²°í•˜ë©° ì•ˆì •í™”

### ì™„ë£Œëœ ì‘ì—… âœ…

1. **Jenkins ì¸ì¦ ì„¤ì •**
   - Bootstrapìœ¼ë¡œ ìƒì„±í•œ `jenkins-terraform-admin@delabs-system-mgmt.iam.gserviceaccount.com` í™œìš©
   - Jenkins Credential IDë¥¼ `gcp-jenkins-service-account`ë¡œ í‘œì¤€í™”
   - Jenkinsfileì— `GOOGLE_APPLICATION_CREDENTIALS` í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€
   - `TG_WORKING_DIR`ì„ workspace root ê¸°ì¤€ ì ˆëŒ€ ê²½ë¡œë¡œ ìˆ˜ì •

2. **Service Account ê¶Œí•œ ì„¤ì •**
   - `roles/storage.admin`: delabs-system-mgmt í”„ë¡œì íŠ¸ (State ë²„í‚· ì ‘ê·¼)
   - `roles/editor`: ê° ì›Œí¬ë¡œë“œ í”„ë¡œì íŠ¸ (ë¦¬ì†ŒìŠ¤ ê´€ë¦¬)
   - ê¶Œí•œ ì„¤ì • ëª…ë ¹ì–´ë¥¼ bootstrap/README.mdì— ë¬¸ì„œí™”

3. **GCS Remote State êµ¬ì„± ê°œì„ **
   - `project = "delabs-system-mgmt"` íŒŒë¼ë¯¸í„° ì¶”ê°€ (í•„ìˆ˜)
   - `location = "US"` íŒŒë¼ë¯¸í„° ì¶”ê°€ (í•„ìˆ˜)
   - jsj-game-gì™€ proj-default-templet ì–‘ìª½ terragrunt.hcl ì—…ë°ì´íŠ¸

4. **Terragrunt In-Place ì‹¤í–‰**
   - ëª¨ë“  ë ˆì´ì–´ terragrunt.hclì—ì„œ `terraform.source = "."` ë¸”ë¡ ì œê±°
   - `.terragrunt-cache` ì‚¬ìš© ì¤‘ë‹¨ìœ¼ë¡œ ëª¨ë“ˆ ìƒëŒ€ ê²½ë¡œ(`../../../../modules`) ë¬¸ì œ í•´ê²°
   - 18ê°œ íŒŒì¼ ìˆ˜ì • (jsj-game-g 9ê°œ + proj-default-templet 9ê°œ)
   - ì‹¤í–‰ ì†ë„ í–¥ìƒ ë° ë””ë²„ê¹… ë‹¨ìˆœí™”

5. **ë¬¸ì„œ ì „ë©´ ì—…ë°ì´íŠ¸**
   - 00_README.md: GCP ì¸ì¦ ì„¹ì…˜ ê°œì„ , Service Account ìƒì„±/ê¶Œí•œ ì•ˆë‚´
   - 02_CHANGELOG.md: 2025-11-06 ë³€ê²½ ì‚¬í•­ ì¶”ê°€
   - 03_QUICK_REFERENCE.md: Session 13 ì‘ì—… ìš”ì•½ ë° ì—ëŸ¬ í•´ê²° ë°©ë²•
   - 05_quick setup guide.md: terragrunt.hcl í•„ìˆ˜ ì„¤ì •, Jenkinsfile êµ¬ì„±
   - bootstrap/README.md: Service Account ê¶Œí•œ ì„¤ì • ì„¹ì…˜ ì¶”ê°€
   - .jenkins/Jenkinsfile.template: Credential ID ì—…ë°ì´íŠ¸
   - .gitignore: jenkins-sa-key.json ì¶”ê°€
6. **í›„ì† ì •ë¦¬**
   - Terragruntê°€ `region_primary`ë¥¼ ê¸°ë³¸ ì ìš©í•˜ë„ë¡ ëª¨ë“  ë ˆì´ì–´ `terraform.tfvars(.example)`ê³¼ READMEì—ì„œ `region = ""` íŒ¨í„´ ì œê±°, ì£¼ì„ ê¸°ë°˜ ì˜¤ë²„ë¼ì´ë“œ ë°©ì‹ìœ¼ë¡œ í†µì¼
   - `modules/gcs-bucket`ì˜ `public_access_prevention`, `retention_policy_days`ê°€ `null`ì¼ ë•Œ Terraformì´ ì‹¤íŒ¨í•˜ì§€ ì•Šë„ë¡ validationê³¼ ë™ì  ë¸”ë¡ ë¡œì§ ê°œì„ 
   - Bootstrap í”„ë¡œì íŠ¸ê°€ `cloudbilling.googleapis.com`, `serviceusage.googleapis.com`ì„ ìë™ í™œì„±í™”í•˜ì—¬ ìƒˆ í”„ë¡œì íŠ¸ ìƒì„± ì‹œ Billing/Service Usage API ì˜¤ë¥˜ ì˜ˆë°©
   - `modules/project-base`ê°€ `org_id` ì…ë ¥ì„ ì§€ì›í•˜ê³  00-project ë¬¸ì„œ/ì˜ˆì œì— ìƒìœ„ ë¦¬ì†ŒìŠ¤ ë° Billing Accountë¥¼ Terragrunt ë£¨íŠ¸ `inputs`ë¡œ ì¤‘ì•™ ê´€ë¦¬í•˜ë„ë¡ ì•ˆë‚´
   - Jenkins Service Account í•„ìˆ˜ ê¶Œí•œ(roles/storage.admin, roles/billing.user ë“±) ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ READMEì™€ Jenkins ë¬¸ì„œì— ì¶”ê°€í•´ apply ì‹¤íŒ¨ë¥¼ ì‚¬ì „ ë°©ì§€

### í•´ê²°í•œ ì—ëŸ¬ ğŸ›

1. **Missing required GCS remote state configuration project**
   - ì›ì¸: GCS backendì— `project` íŒŒë¼ë¯¸í„° ëˆ„ë½
   - í•´ê²°: `project = "delabs-system-mgmt"` ì¶”ê°€

2. **Missing required GCS remote state configuration location**
   - ì›ì¸: GCS backendì— `location` íŒŒë¼ë¯¸í„° ëˆ„ë½
   - í•´ê²°: `location = "US"` ì¶”ê°€

3. **Storage permission denied**
   - ì›ì¸: Service Accountì— State ë²„í‚· ì ‘ê·¼ ê¶Œí•œ ì—†ìŒ
   - í•´ê²°: `roles/storage.admin` ê¶Œí•œ ë¶€ì—¬

4. **Unreadable module directory**
   - ì›ì¸: `.terragrunt-cache`ë¡œ ë³µì‚¬ ì‹œ ìƒëŒ€ ê²½ë¡œ(`../../../../modules`) ê¹¨ì§
   - í•´ê²°: `terraform.source` ì œê±°í•˜ì—¬ in-place ì‹¤í–‰

### ì‚°ì¶œë¬¼ ğŸ—‚ï¸
- `environments/LIVE/jsj-game-g/terragrunt.hcl` (GCS íŒŒë¼ë¯¸í„° ì¶”ê°€)
- `environments/LIVE/jsj-game-g/*/terragrunt.hcl` (9ê°œ, terraform.source ì œê±°)
- `proj-default-templet/terragrunt.hcl` (GCS íŒŒë¼ë¯¸í„° ì¶”ê°€)
- `proj-default-templet/*/terragrunt.hcl` (9ê°œ, terraform.source ì œê±°)
- `environments/LIVE/jsj-game-g/Jenkinsfile` (TG_WORKING_DIR ìˆ˜ì •)
- `.jenkins/Jenkinsfile.template` (Credential ID ì—…ë°ì´íŠ¸)
- ë¬¸ì„œ íŒŒì¼ 6ê°œ ì—…ë°ì´íŠ¸

### ê²€ì¦ âœ…
- Jenkins Pipelineì—ì„œ `terragrunt init` ì„±ê³µ
- GCS State ë²„í‚· ì ‘ê·¼ í™•ì¸
- ëª¨ë“ˆ ì°¸ì¡° ê²½ë¡œ ì •ìƒ ì‘ë™
- ê¶Œí•œ í™•ì¸: `gcloud projects get-iam-policy delabs-system-mgmt`

### ì£¼ìš” ê°œì„  ì‚¬í•­ ğŸ’¡
- **In-place ì‹¤í–‰**: ë³µì‚¬ ì˜¤ë²„í—¤ë“œ ì œê±°, ë””ë²„ê¹… ìš©ì´
- **ê¶Œí•œ ë¬¸ì„œí™”**: Service Account ê¶Œí•œ ì„¤ì • ê°€ì´ë“œ ì¶”ê°€
- **í‘œì¤€í™”**: Credential IDë¥¼ `gcp-jenkins-service-account`ë¡œ í†µì¼
- **ì—ëŸ¬ ê°€ì´ë“œ**: ë°œìƒ ê°€ëŠ¥í•œ ì—ëŸ¬ì™€ í•´ê²° ë°©ë²• ë¬¸ì„œí™”

---

