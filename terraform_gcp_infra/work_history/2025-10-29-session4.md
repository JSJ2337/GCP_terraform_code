## ğŸ“… ì„¸ì…˜ 4 ì‘ì—… ë‚´ì—­ (2025-10-29)

**ì‘ì—…ì**: jsj
**ëª©ì **: í”„ë¡œì íŠ¸ ì‚­ì œ ì •ì±… ê°œì„  ë° í…œí”Œë¦¿í™”

### ğŸ¯ ì‘ì—… ìš”ì•½

í…ŒìŠ¤íŠ¸ í”„ë¡œì íŠ¸ ì‚­ì œ, deletion_policy ë³€ìˆ˜ ì¶”ê°€, í”„ë¡œì íŠ¸ í…œí”Œë¦¿í™”ë¥¼ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.

### ì™„ë£Œëœ ì‘ì—… âœ…

#### 1. JSJ-game-terraform-A í”„ë¡œì íŠ¸ ì™„ì „ ì‚­ì œ

**ì‚­ì œ ìˆœì„œ** (ì—­ìˆœ ì˜ì¡´ì„±):
```bash
# 50-workloads â†’ 40-observability â†’ 30-security â†’ 20-storage â†’ 10-network â†’ 00-project
```

**ì‚­ì œëœ ë¦¬ì†ŒìŠ¤ ìƒì„¸**:

1. **50-workloads (ì›Œí¬ë¡œë“œ)**
   - VM ì¸ìŠ¤í„´ìŠ¤ 2ê°œ ì‚­ì œ

2. **40-observability (ê´€ì°°ì„±)**
   - ë¦¬ì†ŒìŠ¤ ì—†ìŒ (ì´ë¯¸ ê¹¨ë—í•œ ìƒíƒœ)

3. **30-security (ë³´ì•ˆ)**
   - ì„œë¹„ìŠ¤ ê³„ì • 3ê°œ ì‚­ì œ

4. **20-storage (ìŠ¤í† ë¦¬ì§€)**
   - GCS ë²„í‚· 3ê°œ ì‚­ì œ (assets, logs, backups)
   - ë²„í‚·ì˜ ë³´ì¡´ ì •ì±…ìœ¼ë¡œ ì¸í•œ lien ì œê±° í•„ìš”

5. **10-network (ë„¤íŠ¸ì›Œí¬)**
   - VPC ë„¤íŠ¸ì›Œí¬, ì„œë¸Œë„·, ë°©í™”ë²½ ê·œì¹™, Cloud NAT, Cloud Router ë“± 8ê°œ ë¦¬ì†ŒìŠ¤ ì‚­ì œ

6. **00-project (í”„ë¡œì íŠ¸)**
   - ë¬¸ì œ: `deletion_policy = "PREVENT"` ì„¤ì •ìœ¼ë¡œ ì¸í•œ ì‚­ì œ ì°¨ë‹¨
   - í•´ê²°: ëª¨ë“ˆ ìˆ˜ì •í•˜ì—¬ `deletion_policy = "DELETE"` ì ìš©
   - ë¬¸ì œ: GCS ë²„í‚· ë³´ì¡´ ì •ì±…ìœ¼ë¡œ ì¸í•œ lien ìƒì„±
   - í•´ê²°: `gcloud alpha resource-manager liens delete` ì‹¤í–‰
   - GCP í”„ë¡œì íŠ¸ ì™„ì „ ì‚­ì œ ì„±ê³µ

**Lien ì œê±° ê³¼ì •**:
```bash
# Lien í™•ì¸
gcloud alpha resource-manager liens list --project=jsj-game-terraform-a
# NAME: p421548908971-l9ae65f3f-9edc-4361-bb8e-95dbaed5928f
# ORIGIN: storage.googleapis.com
# REASON: Retention policy

# Lien ì‚­ì œ
gcloud alpha resource-manager liens delete p421548908971-l9ae65f3f-9edc-4361-bb8e-95dbaed5928f

# í”„ë¡œì íŠ¸ ì‚­ì œ
terraform destroy -auto-approve
```

#### 2. deletion_policy ë³€ìˆ˜ ì¶”ê°€ (í”„ë¡œì íŠ¸ ìƒì„±/ì‚­ì œ ìœ ì—°ì„± í–¥ìƒ)

**ë¬¸ì œì **:
- í”„ë¡œì íŠ¸ë¥¼ ì‚­ì œí•˜ë ¤ë©´ ë§¤ë²ˆ ëª¨ë“ˆ ì½”ë“œë¥¼ ìˆ˜ì •í•´ì•¼ í•¨
- ê°œë°œ/í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ììœ ë¡œìš´ ìƒì„±/ì‚­ì œê°€ ì–´ë ¤ì›€

**í•´ê²°ì±…**:
ë³€ìˆ˜ë¡œ ë§Œë“¤ì–´ ê¸°ë³¸ê°’ì€ ììœ ë¡­ê²Œ ì‚­ì œ ê°€ëŠ¥í•˜ê²Œ, í•„ìš”ì‹œ ë³´í˜¸

**ë³€ê²½ëœ íŒŒì¼**:

1. **modules/project-base/variables.tf**
```terraform
variable "deletion_policy" {
  type        = string
  default     = "DELETE"
  description = "í”„ë¡œì íŠ¸ ì‚­ì œ ì •ì±…: DELETE (ììœ ë¡­ê²Œ ì‚­ì œ ê°€ëŠ¥) ë˜ëŠ” PREVENT (ì‚­ì œ ë°©ì§€)"
  validation {
    condition     = contains(["DELETE", "PREVENT", "ABANDON"], var.deletion_policy)
    error_message = "deletion_policyëŠ” DELETE, PREVENT, ABANDON ì¤‘ í•˜ë‚˜ì—¬ì•¼ í•©ë‹ˆë‹¤."
  }
}
```

2. **modules/project-base/main.tf**
```terraform
resource "google_project" "this" {
  project_id          = var.project_id
  name                = var.project_name != "" ? var.project_name : var.project_id
  folder_id           = var.folder_id
  billing_account     = var.billing_account
  labels              = var.labels
  auto_create_network = false
  deletion_policy     = var.deletion_policy  # â† ì¶”ê°€
}
```

3. **modules/project-base/README.md**
   - deletion_policy ë³€ìˆ˜ ë¬¸ì„œí™”
   - ì‚¬ìš© ì˜ˆì œ ì¶”ê°€ (ì‚­ì œ ë°©ì§€ê°€ ì„¤ì •ëœ ì¤‘ìš” í”„ë¡œì íŠ¸)
   - ëª¨ë²” ì‚¬ë¡€ì— í™˜ê²½ë³„ ì •ì±… ê°€ì´ë“œ ì¶”ê°€

4. **environments/prod/proj-default-templet/00-project/variables.tf**
```terraform
variable "deletion_policy" {
  type        = string
  default     = "DELETE"
  description = "í”„ë¡œì íŠ¸ ì‚­ì œ ì •ì±…: DELETE (ììœ ë¡­ê²Œ ì‚­ì œ ê°€ëŠ¥) ë˜ëŠ” PREVENT (ì‚­ì œ ë°©ì§€)"
}
```

5. **environments/prod/proj-default-templet/00-project/main.tf**
```terraform
module "project_base" {
  source = "../../../../modules/project-base"
  # ... ê¸°ì¡´ ë³€ìˆ˜ë“¤
  deletion_policy = var.deletion_policy  # â† ì¶”ê°€
}
```

6. **environments/prod/proj-default-templet/00-project/terraform.tfvars.example**
```terraform
# í”„ë¡œì íŠ¸ ì‚­ì œ ì •ì±…
# DELETE (ê¸°ë³¸ê°’): terraform destroyë¡œ ììœ ë¡­ê²Œ ì‚­ì œ ê°€ëŠ¥ (ê°œë°œ/í…ŒìŠ¤íŠ¸ í™˜ê²½)
# PREVENT: ì‹¤ìˆ˜ë¡œ ì¸í•œ ì‚­ì œ ë°©ì§€ (í”„ë¡œë•ì…˜/ì¤‘ìš” ì¸í”„ë¼)
# ABANDON: Terraform stateì—ì„œë§Œ ì œê±°, GCP í”„ë¡œì íŠ¸ëŠ” ìœ ì§€
deletion_policy = "DELETE"
```

**ì‚¬ìš© ê¶Œì¥ì‚¬í•­**:
- ê°œë°œ/í…ŒìŠ¤íŠ¸ í™˜ê²½: `DELETE` (ê¸°ë³¸ê°’) - ììœ ë¡­ê²Œ ìƒì„±/ì‚­ì œ
- í”„ë¡œë•ì…˜/ì¤‘ìš” ì¸í”„ë¼: `PREVENT` - ì‹¤ìˆ˜ë¡œ ì¸í•œ ì‚­ì œ ë°©ì§€
- ë¶€íŠ¸ìŠ¤íŠ¸ë©/ê´€ë¦¬ í”„ë¡œì íŠ¸: `PREVENT` - ë°˜ë“œì‹œ ë³´í˜¸ í•„ìš”

**Bootstrap í”„ë¡œì íŠ¸ ë³´í˜¸**:
```terraform
# bootstrap/main.tfì—ì„œëŠ” ì§ì ‘ í•˜ë“œì½”ë”©
resource "google_project" "mgmt" {
  project_id      = var.project_id
  name            = var.project_name
  billing_account = var.billing_account
  # ...
  deletion_policy = "PREVENT"  # ì‹¤ìˆ˜ë¡œ ì‚­ì œ ë°©ì§€
}
```

#### 3. proj-game-aë¥¼ proj-default-templetìœ¼ë¡œ ë¦¬ë„¤ì„

**ëª©ì **: ë²”ìš©ì ì¸ í…œí”Œë¦¿ ì´ë¦„ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ìƒˆ í”„ë¡œì íŠ¸ ìƒì„± ì‹œ ë³µì‚¬í•˜ì—¬ ì‚¬ìš©

**ë³€ê²½ ë‚´ì—­**:

1. **ë””ë ‰í† ë¦¬ ì´ë¦„ ë³€ê²½**
```bash
mv environments/prod/proj-game-a environments/prod/proj-default-templet
```

2. **ëª¨ë“  íŒŒì¼ì—ì„œ "game-a" â†’ "default-templet" ì°¸ì¡° ì—…ë°ì´íŠ¸**

**ì—…ë°ì´íŠ¸ëœ íŒŒì¼ (37ê°œ)**:
- `locals.tf`: `project_name = "default-templet"`
- ëª¨ë“  `backend.tf`: `prefix = "proj-default-templet/..."`
- `00-project/main.tf`: ë ˆì´ë¸”ì—ì„œ `project = "default-templet"`
- `00-project/terraform.tfvars.example`: `project_name = "Default Template Production"`
- `10-network/main.tf`: `project_name = "default-templet"`
- `20-storage/terraform.tfvars`: ë²„í‚· ì´ë¦„ ë° ë ˆì´ë¸”
- `30-security/terraform.tfvars`: ì„œë¹„ìŠ¤ ê³„ì • ì´ë¦„
- `40-observability`: backend prefix
- `50-workloads/main.tf`: `project_name = "default-templet"`
- ëª¨ë“  `.tfvars` ë° `.tfvars.example` íŒŒì¼

3. **ê²€ì¦**
```bash
# game-a ì°¸ì¡°ê°€ ë‚¨ì•„ìˆëŠ”ì§€ í™•ì¸
grep -r "game-a" --include="*.tf" --include="*.tfvars" .
# ê²°ê³¼: ì—†ìŒ (ëª¨ë‘ ì—…ë°ì´íŠ¸ ì™„ë£Œ)
```

### ğŸ“Š Git ì»¤ë°‹ ë‚´ì—­

**ì»¤ë°‹ 1**: `011e26d` - feat: í”„ë¡œì íŠ¸ ì‚­ì œ ì •ì±…ì„ ì œì–´í•  ìˆ˜ ìˆëŠ” deletion_policy ë³€ìˆ˜ ì¶”ê°€
- modules/project-baseì— deletion_policy ë³€ìˆ˜ ì¶”ê°€
- 3 files changed, 51 insertions(+), 5 deletions(-)

**ì»¤ë°‹ 2**: `495042d` - feat: proj-game-a ë£¨íŠ¸ ëª¨ë“ˆì— deletion_policy ë³€ìˆ˜ ì ìš©
- environments/prod/proj-game-a/00-project ì—…ë°ì´íŠ¸
- 3 files changed, 13 insertions(+)

**ì»¤ë°‹ 3**: `c9db5a7` - refactor: proj-game-aë¥¼ proj-default-templetìœ¼ë¡œ ë¦¬ë„¤ì„
- ë””ë ‰í† ë¦¬ ì´ë¦„ ë³€ê²½ ë° ëª¨ë“  ì°¸ì¡° ì—…ë°ì´íŠ¸
- 37 files changed, 46 insertions(+), 46 deletions(-)

### ğŸ’¡ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤ ì ìš©

1. **ìœ ì—°í•œ í”„ë¡œì íŠ¸ ê´€ë¦¬**
   - í™˜ê²½ë³„ë¡œ ì ì ˆí•œ deletion_policy ì„¤ì • ê°€ëŠ¥
   - ê¸°ë³¸ê°’ì€ ììœ ë¡­ê²Œ ì‚­ì œ ê°€ëŠ¥í•˜ê²Œ ì„¤ì • (ê°œë°œ ì¹œí™”ì )
   - validationìœ¼ë¡œ ì˜ëª»ëœ ê°’ ì…ë ¥ ë°©ì§€

2. **ì•ˆì „í•œ ì¸í”„ë¼ ì‚­ì œ**
   - ì˜ì¡´ì„± ì—­ìˆœìœ¼ë¡œ ì‚­ì œ (50 â†’ 00)
   - lien ì œê±° í›„ í”„ë¡œì íŠ¸ ì‚­ì œ
   - ê° ë‹¨ê³„ì—ì„œ ë¦¬ì†ŒìŠ¤ í™•ì¸

3. **í…œí”Œë¦¿í™”**
   - ë²”ìš©ì ì¸ ì´ë¦„ìœ¼ë¡œ ë³€ê²½
   - ìƒˆ í”„ë¡œì íŠ¸ ìƒì„± ì‹œ ë³µì‚¬í•˜ì—¬ ì‚¬ìš© ê°€ëŠ¥
   - ëª¨ë“  ì°¸ì¡° ì¼ê´€ì„± ìˆê²Œ ì—…ë°ì´íŠ¸

### ğŸš€ ë‹¤ìŒ ì„¸ì…˜ ì‘ì—… (ìš°ì„ ìˆœìœ„)

#### Priority 1: í…œí”Œë¦¿ ê¸°ë°˜ ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±
```bash
# proj-default-templetì„ ë³µì‚¬í•˜ì—¬ ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±
cp -r environments/prod/proj-default-templet environments/prod/proj-new-project

# ëª¨ë“  íŒŒì¼ì—ì„œ "default-templet" â†’ "new-project" ì¹˜í™˜
find environments/prod/proj-new-project -type f \( -name "*.tf" -o -name "*.tfvars" \) \
  -exec sed -i 's/default-templet/new-project/g' {} +
```

#### Priority 2: ë¬¸ì„œí™”
1. í…œí”Œë¦¿ ì‚¬ìš© ê°€ì´ë“œ ì‘ì„±
2. í”„ë¡œì íŠ¸ ìƒì„± ìë™í™” ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±
3. deletion_policy ì‚¬ìš© ê°€ì´ë“œ ì¶”ê°€

#### Priority 3: Bootstrap í”„ë¡œì íŠ¸ ê²€ì¦
- Bootstrap í”„ë¡œì íŠ¸ê°€ PREVENT ì •ì±…ì„ ì‚¬ìš©í•˜ëŠ”ì§€ í™•ì¸
- Bootstrap state íŒŒì¼ ë°±ì—… ìƒíƒœ í™•ì¸

### âš ï¸ ì£¼ìš” í•™ìŠµ ì‚¬í•­

#### Lien ê´€ë ¨
- GCS ë²„í‚·ì˜ ë³´ì¡´ ì •ì±…(retention policy)ì€ í”„ë¡œì íŠ¸ ì‚­ì œ ì‹œ ìë™ìœ¼ë¡œ lien ìƒì„±
- lienì´ ìˆìœ¼ë©´ í”„ë¡œì íŠ¸ ì‚­ì œ ë¶ˆê°€
- `gcloud alpha resource-manager liens list`ë¡œ í™•ì¸
- `gcloud alpha resource-manager liens delete`ë¡œ ì œê±° í›„ ì‚­ì œ ê°€ëŠ¥

#### Deletion Policy
- ëª¨ë“ˆ ìˆ˜ì¤€ì—ì„œ í•˜ë“œì½”ë”©í•˜ëŠ” ê²ƒë³´ë‹¤ ë³€ìˆ˜ë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ìœ ì—°í•¨
- ê¸°ë³¸ê°’ì€ ê°œë°œ í™˜ê²½ì— ë§ê²Œ `DELETE`ë¡œ ì„¤ì •
- í”„ë¡œë•ì…˜/ì¤‘ìš” ì¸í”„ë¼ëŠ” ëª…ì‹œì ìœ¼ë¡œ `PREVENT` ì„¤ì •
- Bootstrap í”„ë¡œì íŠ¸ëŠ” í•˜ë“œì½”ë”©ìœ¼ë¡œ `PREVENT` ê°•ì œ

### ğŸ“ ë³€ê²½ëœ íŒŒì¼ ëª©ë¡

**ìˆ˜ì •ëœ íŒŒì¼ (43ê°œ)**:
1. `modules/project-base/main.tf`
2. `modules/project-base/variables.tf`
3. `modules/project-base/README.md`
4. `environments/prod/proj-default-templet/00-project/variables.tf`
5. `environments/prod/proj-default-templet/00-project/main.tf`
6. `environments/prod/proj-default-templet/00-project/terraform.tfvars.example`
7. `environments/prod/proj-default-templet/00-project/backend.tf`
8. `environments/prod/proj-default-templet/00-project/terraform.tfvars`
9. `environments/prod/proj-default-templet/10-network/backend.tf`
10. `environments/prod/proj-default-templet/10-network/main.tf`
11. `environments/prod/proj-default-templet/10-network/terraform.tfvars`
12. ... (ì´ 37ê°œ íŒŒì¼ ë¦¬ë„¤ì„ ë° ë‚´ìš© ì—…ë°ì´íŠ¸)

**ì‚­ì œëœ ì¸í”„ë¼**:
- JSJ-game-terraform-A í”„ë¡œì íŠ¸ ë° ëª¨ë“  í•˜ìœ„ ë¦¬ì†ŒìŠ¤

---

