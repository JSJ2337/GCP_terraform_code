# 작업 이력 - 2025-11-12

**작업자**: Codex  
**브랜치**: 433_code

---

## 🎯 작업 요약
- jsj-game-l 환경을 기준으로 proj-default-templet과 jsj-game-k 전체를 다시 동기화
- Jenkins Terragrunt 파이프라인 안정화(Provider 캐시 + 재시도 + 경로 이스케이프)
- Cloud SQL 삭제 보호 기본값을 해제하여 destroy 막힘 방지
- GCE VM 재생성 시 Persistent Disk를 유지하도록 모듈/README 업데이트

---

## ✅ 완료된 작업
1. **템플릿/환경 동기화**
   - `proj-default-templet`를 jsj-game-l에서 그대로 복사해 최신 상태로 맞추고
   - 같은 내용을 jsj-game-k에도 반영하여 구조/문서/예제가 모두 동일 패턴을 따르도록 정비
2. **Terraform 파이프라인 안정화**
   - Jenkinsfile (템플릿·jsj-game-l·jsj-game-k)에서 Provider 캐시(`TF_PLUGIN_CACHE_DIR`) 및 `retry(3)` 로직 적용
   - 캐시 디렉터리 생성 시 경로 전체를 `'...'`로 감싸 (LIVE) 같은 괄호가 있는 Job 이름에서도 오류가 없도록 수정
3. **Cloud SQL 삭제 보호 기본 해제**
   - 모듈 기본값과 모든 tfvars(example 포함)를 `deletion_protection = false`로 조정, README/CHANGELOG에 가이드 추가
4. **GCE 부팅 디스크 분리**
   - `modules/gce-vmset`이 인스턴스용 Persistent Disk를 별도 리소스로 생성하고 `auto_delete = false`로 유지하도록 개선
   - 50-workloads README에 디스크 재사용 패턴과 `boot_disk_name` 옵션 설명 추가

---

## 🐛 해결한 이슈
- Terragrunt destroy 중 Cloud SQL 삭제 보호로 인해 실패하던 문제 → 기본값 false로 통일
- Jenkins 워크스페이스 경로에 괄호가 포함돼 `mkdir -p`가 실패하던 문제 → 경로 이스케이프 처리
- HashiCorp provider에서 일시적인 `unexpected EOF`로 init이 중단되던 문제 → Provider 캐시 + 재시도로 완화
- GCE machine_type 변경 시 디스크가 같이 사라지던 문제 → Persistent Disk 분리로 데이터 보존

---

## 🔗 관련 커밋
- `chore: sync template and game-k with game-l`
- `feat: keep GCE boot disks persistent`
- `chore: disable Cloud SQL deletion protection by default`
- (기존) `chore: Jenkins provider 캐시 재시도 적용`, `fix: Jenkins 캐시 경로 특수문자 대응`

---

## 📌 추가 메모
- game-k 환경에 템플릿을 덮어쓴 뒤 프로젝트/서브넷 명만 교체했으므로, 고유 값이 필요한 tfvars(예: billing 계정)만 다시 입력하면 됩니다.
- GCE 디스크를 분리한 만큼 `terraform destroy` 후 디스크가 남을 수 있으니, 완전 삭제가 필요하면 별도로 `google_compute_disk` 리소스를 destroy 하거나 수동 제거하세요.
- 50-workloads Instance Group 예제를 Zone별로 쪼개 MIG 없이도 LB가 멀티존으로 붙을 수 있도록 재구성
