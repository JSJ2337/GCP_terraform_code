version: "3.9"

services:
  ftt-loki:
    container_name: ftt-loki
    image: grafana/loki:3.5.1
    user: "0"                       # 컨테이너 프로세스를 root 로 실행
    command:
      - -config.file=/etc/loki/loki-config.yaml
      - -config.expand-env=true
      - -log.level=info             # 로깅 레벨 설정
    ports:
      - "3100:3100"
    volumes:
      - ./data:/loki                        # TSDB 및 인덱스 저장소
      - ./config/loki-config.yaml:/etc/loki/loki-config.yaml:ro  # 설정 파일
    environment:
      AWS_REGION: ap-southeast-1           # S3 리전
      LOKI_S3_BUCKET: rag-mimir-pos-s3     # S3 버킷명
      # AWS_ACCESS_KEY_ID / AWS_SECRET_ACCESS_KEY은 외부에서 주입
    restart: unless-stopped
    networks:
      - mimir-net

networks:
  mimir-net:
    external: true
